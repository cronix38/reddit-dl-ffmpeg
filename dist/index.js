(()=>{function t(t){return t&&t.__esModule?t.default:t}var e,r,i,n,a,s,o,u,f=globalThis,l={},h=function(t){var e,r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function l(t,r,i,a){var s,o,u=Object.create((r&&r.prototype instanceof m?r:m).prototype);return n(u,"_invoke",{value:(s=new S(a||[]),o=c,function(r,n){if(o===p)throw Error("Generator is already running");if(o===g){if("throw"===r)throw n;return N()}for(s.method=r,s.arg=n;;){var a=s.delegate;if(a){var u=function t(r,i){var n=i.method,a=r.iterator[n];if(a===e)return i.delegate=null,"throw"===n&&r.iterator.return&&(i.method="return",i.arg=e,t(r,i),"throw"===i.method)||"return"!==n&&(i.method="throw",i.arg=TypeError("The iterator does not provide a '"+n+"' method")),d;var s=h(a,r.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,d;var o=s.arg;return o?o.done?(i[r.resultName]=o.value,i.next=r.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,d):o:(i.method="throw",i.arg=TypeError("iterator result is not an object"),i.delegate=null,d)}(a,s);if(u){if(u===d)continue;return u}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(o===c)throw o=g,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);o=p;var f=h(t,i,s);if("normal"===f.type){if(o=s.done?g:"suspendedYield",f.arg===d)continue;return{value:f.arg,done:s.done}}"throw"===f.type&&(o=g,s.method="throw",s.arg=f.arg)}})}),u}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var c="suspendedStart",p="executing",g="completed",d={};function m(){}function y(){}function b(){}var E={};f(E,s,function(){return this});var w=Object.getPrototypeOf,T=w&&w(w(P([])));T&&T!==r&&i.call(T,s)&&(E=T);var A=b.prototype=m.prototype=Object.create(E);function v(t){["next","throw","return"].forEach(function(e){f(t,e,function(t){return this._invoke(e,t)})})}function R(t,e){var r;n(this,"_invoke",{value:function(n,a){function s(){return new e(function(r,s){!function r(n,a,s,o){var u=h(t[n],t,a);if("throw"===u.type)o(u.arg);else{var f=u.arg,l=f.value;return l&&"object"==typeof l&&i.call(l,"__await")?e.resolve(l.__await).then(function(t){r("next",t,s,o)},function(t){r("throw",t,s,o)}):e.resolve(l).then(function(t){f.value=t,s(f)},function(t){return r("throw",t,s,o)})}}(n,a,r,s)})}return r=r?r.then(s,s):s()}})}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function P(t){if(t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}return{next:N}}function N(){return{value:e,done:!0}}return y.prototype=b,n(A,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:y,configurable:!0}),y.displayName=f(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,f(t,u,"GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},v(R.prototype),f(R.prototype,o,function(){return this}),t.AsyncIterator=R,t.async=function(e,r,i,n,a){void 0===a&&(a=Promise);var s=new R(l(e,r,i,n),a);return t.isGeneratorFunction(r)?s:s.next().then(function(t){return t.done?t.value:s.next()})},v(A),f(A,u,"Generator"),f(A,s,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return o.type="throw",o.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),f=i.call(s,"finallyLoc");if(u&&f){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else if(f){if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else throw Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return(s.type=t,s.arg=e,a)?(this.method="next",this.next=a.finallyLoc,d):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;O(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:P(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),d}},t}({});try{regeneratorRuntime=h}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=h:Function("r","regeneratorRuntime = r")(h)}var c={},p={},g=(p={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}}).defaultArgs,d=p.baseOptions,m={};m=(t,e)=>{let r=t._malloc(e.length*Uint32Array.BYTES_PER_ELEMENT);return e.forEach((e,i)=>{let n=t.lengthBytesUTF8(e)+1,a=t._malloc(n);t.stringToUTF8(e,a,n),t.setValue(r+Uint32Array.BYTES_PER_ELEMENT*i,a,"i32")}),[e.length,r]};var y={};y=JSON.parse('{"name":"@ffmpeg/ffmpeg","version":"0.11.6","description":"FFmpeg WebAssembly version","main":"src/index.js","types":"src/index.d.ts","directories":{"example":"examples"},"scripts":{"start":"node scripts/server.js","start:worker":"node scripts/worker-server.js","build":"rimraf dist && webpack --config scripts/webpack.config.prod.js","build:worker":"rimraf dist && webpack --config scripts/webpack.config.worker.prod.js","prepublishOnly":"npm run build","lint":"eslint src","wait":"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js","test":"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node node_modules/mocha/bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},"browser":{"./src/node/index.js":"./src/browser/index.js"},"repository":{"type":"git","url":"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},"keywords":["ffmpeg","WebAssembly","video"],"author":"Jerome Wu <jeromewus@gmail.com>","license":"MIT","bugs":{"url":"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},"engines":{"node":">=12.16.1"},"homepage":"https://github.com/ffmpegwasm/ffmpeg.wasm#readme","dependencies":{"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},"devDependencies":{"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.11.0","@types/emscripten":"^1.39.4","babel-eslint":"^10.1.0","babel-loader":"^8.1.0","chai":"^4.2.0","cors":"^2.8.5","eslint":"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1","express":"^4.17.1","mocha":"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0","webpack":"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"}}');var b={};function E(){throw Error("setTimeout has not been defined")}function w(){throw Error("clearTimeout has not been defined")}function T(t){if(e===setTimeout)return setTimeout(t,0);if((e===E||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:E}catch(t){e=E}try{r="function"==typeof clearTimeout?clearTimeout:w}catch(t){r=w}}();var A=[],v=!1,R=-1;function I(){v&&i&&(v=!1,i.length?A=i.concat(A):R=-1,A.length&&O())}function O(){if(!v){var t=T(I);v=!0;for(var e=A.length;e;){for(i=A,A=[];++R<e;)i&&i[R].run();R=-1,e=A.length}i=null,v=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===w||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function S(t,e){this.fun=t,this.array=e}function P(){}b.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];A.push(new S(t,e)),1!==A.length||v||T(O)},S.prototype.run=function(){this.fun.apply(null,this.array)},b.title="browser",b.browser=!0,b.env={},b.argv=[],b.version="",b.versions={},b.on=P,b.addListener=P,b.once=P,b.off=P,b.removeListener=P,b.removeAllListeners=P,b.emit=P,b.prependListener=P,b.prependOnceListener=P,b.listeners=function(t){return[]},b.binding=function(t){throw Error("process.binding is not supported")},b.cwd=function(){return"/"},b.chdir=function(t){throw Error("process.chdir is not supported")},b.umask=function(){return 0};let N=`https://unpkg.com/@ffmpeg/core@${t(y).devDependencies["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`;var D={};let B=!1,L=()=>{};D={logging:!1,setLogging:t=>{B=t},setCustomLogger:t=>{L=t},log:(t,e)=>{L({type:t,message:e}),B&&console.log(`[${t}] ${e}`)}};var U={};U={CREATE_FFMPEG_CORE_IS_NOT_DEFINED:t=>`
createFFmpegCore is not defined. ffmpeg.wasm is unable to find createFFmpegCore after loading ffmpeg-core.js from ${t}. Use another URL when calling createFFmpeg():

const ffmpeg = createFFmpeg({
  corePath: 'http://localhost:3000/ffmpeg-core.js',
});
`};let F=async(t,e)=>{(0,D.log)("info",`fetch ${t}`);let r=await (await fetch(t)).arrayBuffer();(0,D.log)("info",`${t} file size = ${r.byteLength} bytes`);let i=new Blob([r],{type:e}),n=URL.createObjectURL(i);return(0,D.log)("info",`${t} blob URL = ${n}`),n},C=async({corePath:t,workerPath:e,wasmPath:r})=>{if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){if("string"!=typeof t)throw Error("corePath should be a string!");let i=new URL(t,"file:///node_modules/@ffmpeg/ffmpeg/src/browser/getCreateFFmpegCore.js").href,n=await F(i,"application/javascript"),a=await F(void 0!==r?r:i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),s=await F(void 0!==e?e:i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return"undefined"==typeof createFFmpegCore?new Promise(t=>{if(globalThis.importScripts(n),"undefined"==typeof createFFmpegCore)throw Error((0,U.CREATE_FFMPEG_CORE_IS_NOT_DEFINED)(i));(0,D.log)("info","ffmpeg-core.js script loaded"),t({createFFmpegCore:createFFmpegCore,corePath:n,wasmPath:a,workerPath:s})}):((0,D.log)("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore:createFFmpegCore,corePath:n,wasmPath:a,workerPath:s}))}if("string"!=typeof t)throw Error("corePath should be a string!");let i=new URL(t,"file:///node_modules/@ffmpeg/ffmpeg/src/browser/getCreateFFmpegCore.js").href,n=await F(i,"application/javascript"),a=await F(void 0!==r?r:i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),s=await F(void 0!==e?e:i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return"undefined"==typeof createFFmpegCore?new Promise(t=>{let e=document.createElement("script"),r=()=>{if(e.removeEventListener("load",r),"undefined"==typeof createFFmpegCore)throw Error((0,U.CREATE_FFMPEG_CORE_IS_NOT_DEFINED)(i));(0,D.log)("info","ffmpeg-core.js script loaded"),t({createFFmpegCore:createFFmpegCore,corePath:n,wasmPath:a,workerPath:s})};e.src=n,e.type="text/javascript",e.addEventListener("load",r),document.getElementsByTagName("head")[0].appendChild(e)}):((0,D.log)("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore:createFFmpegCore,corePath:n,wasmPath:a,workerPath:s}))},x=t=>new Promise((e,r)=>{let i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=({target:{error:{code:t}}})=>{r(Error(`File could not be read! Code=${t}`))},i.readAsArrayBuffer(t)}),X=async t=>{let e=t;if(void 0===t)return new Uint8Array;if("string"==typeof t){if(/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t))e=atob(t.split(",")[1]).split("").map(t=>t.charCodeAt(0));else{let r=await fetch(new URL(t,"file:///node_modules/@ffmpeg/ffmpeg/src/browser/fetchFile.js").href);e=await r.arrayBuffer()}}else(t instanceof File||t instanceof Blob)&&(e=await x(t));return new Uint8Array(e)};var $={corePath:N},M=y.version;let _=Error("ffmpeg.wasm is not ready, make sure you have completed load().");l={createFFmpeg:(t={})=>{let{log:e,logger:r,progress:i,...n}={...d,...$,...t},a=null,s=null,o=null,u=null,f=!1,l=()=>{},h=e,c=i,p=0,y=0,b=!1,E=0,w=t=>{"FFMPEG_END"===t&&null!==o&&(o(),o=null,u=null,f=!1)},T=(t,e)=>{l({type:t,message:e}),h&&console.log(`[${t}] ${e}`)},A=t=>{let[e,r,i]=t.split(":");return 3600*parseFloat(e)+60*parseFloat(r)+parseFloat(i)},v=(t,e)=>{if("string"==typeof t){if(t.startsWith("  Duration")){let r=A(t.split(", ")[0].split(": ")[1]);e({duration:r,ratio:E}),(0===p||p>r)&&(p=r,b=!0)}else if(b&&t.startsWith("    Stream")){let e=t.match(/([\d.]+) fps/);if(e){let t=parseFloat(e[1]);y=p*t}else y=0;b=!1}else if(t.startsWith("frame")||t.startsWith("size")){let r=A(t.split("time=")[1].split(" ")[0]),i=t.match(/frame=\s*(\d+)/);e({ratio:E=y&&i?Math.min(parseFloat(i[1])/y,1):r/p,time:r})}else t.startsWith("video:")&&(e({ratio:1}),p=0)}},R=({type:t,message:e})=>{T(t,e),v(e,c),w(e)},I=async()=>{if(T("info","load ffmpeg-core"),null===a){T("info","loading ffmpeg-core");let{createFFmpegCore:t,corePath:e,workerPath:r,wasmPath:i}=await C(n);s=(a=await t({mainScriptUrlOrBlob:e,printErr:t=>R({type:"fferr",message:t}),print:t=>R({type:"ffout",message:t}),locateFile:(t,e)=>{if("undefined"!=typeof window||"undefined"!=typeof WorkerGlobalScope){if(void 0!==i&&t.endsWith("ffmpeg-core.wasm"))return i;if(void 0!==r&&t.endsWith("ffmpeg-core.worker.js"))return r}return e+t}})).cwrap(n.mainName||"proxy_main","number",["number","number"]),T("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")};return T("info",`use ffmpeg.wasm v${M}`),{setProgress:t=>{c=t},setLogger:t=>{l=t},setLogging:t=>{h=t},load:I,isLoaded:()=>null!==a,run:(...t)=>{if(T("info",`run ffmpeg command: ${t.join(" ")}`),null===a)throw _;if(!f)return f=!0,new Promise((e,r)=>{let i=[...g,...t].filter(t=>0!==t.length);o=e,u=r,s(...m(a,i))});throw Error("ffmpeg.wasm can only run one command at a time")},exit:()=>{if(null===a)throw _;u&&u("ffmpeg has exited"),f=!1;try{a.exit(1)}catch(t){T(t.message),u&&u(t)}finally{a=null,s=null,o=null,u=null}},FS:(t,...e)=>{if(T("info",`run FS.${t} ${e.map(t=>"string"==typeof t?t:`<${t.length} bytes binary file>`).join(" ")}`),null===a)throw _;{let r=null;try{r=a.FS[t](...e)}catch(r){if("readdir"===t)throw Error(`ffmpeg.FS('readdir', '${e[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`);if("readFile"===t)throw Error(`ffmpeg.FS('readFile', '${e[0]}') error. Check if the path exists`);throw Error("Oops, something went wrong in FS operation.")}return r}}}},fetchFile:X};/*! @name m3u8-parser @version 7.1.0 @license Apache-2.0 */var k=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var r=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(r,1),r>-1},e.trigger=function(t){var e=this.listeners[t];if(e){if(2==arguments.length)for(var r=e.length,i=0;i<r;++i)e[i].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),a=e.length,s=0;s<a;++s)e[s].apply(this,n)}},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",function(e){t.push(e)})},t}(),j={};function G(){return(j=G=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)({}).hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).__esModule=!0,j.default=j,G.apply(null,arguments)}(j=G).__esModule=!0,j.default=j;var Y={};"undefined"!=typeof window?n=window:void 0!==f?n=f:"undefined"!=typeof self?n=self:n={},Y=n,a=function(t){var e,r,i=function(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var i=r===e?0:4-r%4;return[r,i]}(t),n=i[0],a=i[1],s=new K((n+a)*3/4-a),o=0,u=a>0?n-4:n;for(r=0;r<u;r+=4)e=H[t.charCodeAt(r)]<<18|H[t.charCodeAt(r+1)]<<12|H[t.charCodeAt(r+2)]<<6|H[t.charCodeAt(r+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=255&e;return 2===a&&(e=H[t.charCodeAt(r)]<<2|H[t.charCodeAt(r+1)]>>4,s[o++]=255&e),1===a&&(e=H[t.charCodeAt(r)]<<10|H[t.charCodeAt(r+1)]<<4|H[t.charCodeAt(r+2)]>>2,s[o++]=e>>8&255,s[o++]=255&e),s},s=function(t){for(var e,r=t.length,i=r%3,n=[],a=0,s=r-i;a<s;a+=16383)n.push(function(t,e,r){for(var i,n=[],a=e;a<r;a+=3)n.push(V[(i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]))>>18&63]+V[i>>12&63]+V[i>>6&63]+V[63&i]);return n.join("")}(t,a,a+16383>s?s:a+16383));return 1===i?n.push(V[(e=t[r-1])>>2]+V[e<<4&63]+"=="):2===i&&n.push(V[(e=(t[r-2]<<8)+t[r-1])>>10]+V[e>>4&63]+V[e<<2&63]+"="),n.join("")};for(var V=[],H=[],K="undefined"!=typeof Uint8Array?Uint8Array:Array,q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=0,z=q.length;W<z;++W)V[W]=q[W],H[q.charCodeAt(W)]=W;H["-".charCodeAt(0)]=62,H["_".charCodeAt(0)]=63,o=function(t,e,r,i,n){var a,s,o=8*n-i-1,u=(1<<o)-1,f=u>>1,l=-7,h=r?n-1:0,c=r?-1:1,p=t[e+h];for(h+=c,a=p&(1<<-l)-1,p>>=-l,l+=o;l>0;a=256*a+t[e+h],h+=c,l-=8);for(s=a&(1<<-l)-1,a>>=-l,l+=i;l>0;s=256*s+t[e+h],h+=c,l-=8);if(0===a)a=1-f;else{if(a===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),a-=f}return(p?-1:1)*s*Math.pow(2,a-i)},u=function(t,e,r,i,n,a){var s,o,u,f=8*a-n-1,l=(1<<f)-1,h=l>>1,c=23===n?5960464477539062e-23:0,p=i?0:a-1,g=i?1:-1,d=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(o=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),s+h>=1?e+=c/u:e+=c*Math.pow(2,1-h),e*u>=2&&(s++,u/=2),s+h>=l?(o=0,s=l):s+h>=1?(o=(e*u-1)*Math.pow(2,n),s+=h):(o=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[r+p]=255&o,p+=g,o/=256,n-=8);for(s=s<<n|o,f+=n;f>0;t[r+p]=255&s,p+=g,s/=256,f-=8);t[r+p-g]|=128*d};let J="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function Z(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');let e=new Uint8Array(t);return Object.setPrototypeOf(e,Q.prototype),e}function Q(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return tr(t)}return tt(t,e,r)}function tt(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!Q.isEncoding(e))throw TypeError("Unknown encoding: "+e);let r=0|ts(t,e),i=Z(r),n=i.write(t,e);return n!==r&&(i=i.slice(0,n)),i}(t,e);if(ArrayBuffer.isView(t))return function(t){if(tN(t,Uint8Array)){let e=new Uint8Array(t);return tn(e.buffer,e.byteOffset,e.byteLength)}return ti(t)}(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(tN(t,ArrayBuffer)||t&&tN(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(tN(t,SharedArrayBuffer)||t&&tN(t.buffer,SharedArrayBuffer)))return tn(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');let i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return Q.from(i,e,r);let n=function(t){var e;if(Q.isBuffer(t)){let e=0|ta(t.length),r=Z(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?Z(0):ti(t):"Buffer"===t.type&&Array.isArray(t.data)?ti(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return Q.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function te(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function tr(t){return te(t),Z(t<0?0:0|ta(t))}function ti(t){let e=t.length<0?0:0|ta(t.length),r=Z(e);for(let i=0;i<e;i+=1)r[i]=255&t[i];return r}function tn(t,e,r){let i;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Q.prototype),i}function ta(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function ts(t,e){if(Q.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||tN(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return tO(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return tS(t).length;default:if(n)return i?-1:tO(t).length;e=(""+e).toLowerCase(),n=!0}}function to(t,e,r){let i=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){let i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=e;i<r;++i)n+=tD[t[i]];return n}(this,e,r);case"utf8":case"utf-8":return th(this,e,r);case"ascii":return function(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}(this,e,r);case"latin1":case"binary":return function(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}(this,e,r);case"base64":var n,a;return n=e,a=r,0===n&&a===this.length?s(this):s(this.slice(n,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){let i=t.slice(e,r),n="";for(let t=0;t<i.length-1;t+=2)n+=String.fromCharCode(i[t]+256*i[t+1]);return n}(this,e,r);default:if(i)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function tu(t,e,r){let i=t[e];t[e]=t[r],t[r]=i}function tf(t,e,r,i,n){var a;if(0===t.length)return -1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(a=r=+r)!=a&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return -1;r=t.length-1}else if(r<0){if(!n)return -1;r=0}if("string"==typeof e&&(e=Q.from(e,i)),Q.isBuffer(e))return 0===e.length?-1:tl(t,e,r,i,n);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):tl(t,[e],r,i,n);throw TypeError("val must be string, number or Buffer")}function tl(t,e,r,i,n){let a,s=1,o=t.length,u=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return -1;s=2,o/=2,u/=2,r/=2}function f(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(n){let i=-1;for(a=r;a<o;a++)if(f(t,a)===f(e,-1===i?0:a-i)){if(-1===i&&(i=a),a-i+1===u)return i*s}else -1!==i&&(a-=a-i),i=-1}else for(r+u>o&&(r=o-u),a=r;a>=0;a--){let r=!0;for(let i=0;i<u;i++)if(f(t,a+i)!==f(e,i)){r=!1;break}if(r)return a}return -1}function th(t,e,r){r=Math.min(t.length,r);let i=[],n=e;for(;n<r;){let e=t[n],a=null,s=e>239?4:e>223?3:e>191?2:1;if(n+s<=r){let r,i,o,u;switch(s){case 1:e<128&&(a=e);break;case 2:(192&(r=t[n+1]))==128&&(u=(31&e)<<6|63&r)>127&&(a=u);break;case 3:r=t[n+1],i=t[n+2],(192&r)==128&&(192&i)==128&&(u=(15&e)<<12|(63&r)<<6|63&i)>2047&&(u<55296||u>57343)&&(a=u);break;case 4:r=t[n+1],i=t[n+2],o=t[n+3],(192&r)==128&&(192&i)==128&&(192&o)==128&&(u=(15&e)<<18|(63&r)<<12|(63&i)<<6|63&o)>65535&&u<1114112&&(a=u)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,i.push(a>>>10&1023|55296),a=56320|1023&a),i.push(a),n+=s}return function(t){let e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);let r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return r}(i)}function tc(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function tp(t,e,r,i,n,a){if(!Q.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<a)throw RangeError('"value" argument is out of bounds');if(r+i>t.length)throw RangeError("Index out of range")}function tg(t,e,r,i,n){tA(e,i,n,t,r,7);let a=Number(e&BigInt(4294967295));t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,r}function td(t,e,r,i,n){tA(e,i,n,t,r,7);let a=Number(e&BigInt(4294967295));t[r+7]=a,a>>=8,t[r+6]=a,a>>=8,t[r+5]=a,a>>=8,t[r+4]=a;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=s,s>>=8,t[r+2]=s,s>>=8,t[r+1]=s,s>>=8,t[r]=s,r+8}function tm(t,e,r,i,n,a){if(r+i>t.length||r<0)throw RangeError("Index out of range")}function ty(t,e,r,i,n){return e=+e,r>>>=0,n||tm(t,e,r,4,34028234663852886e22,-34028234663852886e22),u(t,e,r,i,23,4),r+4}function tb(t,e,r,i,n){return e=+e,r>>>=0,n||tm(t,e,r,8,17976931348623157e292,-17976931348623157e292),u(t,e,r,i,52,8),r+8}Q.TYPED_ARRAY_SUPPORT=function(){try{let t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),Q.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Q.prototype,"parent",{enumerable:!0,get:function(){if(Q.isBuffer(this))return this.buffer}}),Object.defineProperty(Q.prototype,"offset",{enumerable:!0,get:function(){if(Q.isBuffer(this))return this.byteOffset}}),Q.poolSize=8192,Q.from=function(t,e,r){return tt(t,e,r)},Object.setPrototypeOf(Q.prototype,Uint8Array.prototype),Object.setPrototypeOf(Q,Uint8Array),Q.alloc=function(t,e,r){return(te(t),t<=0)?Z(t):void 0!==e?"string"==typeof r?Z(t).fill(e,r):Z(t).fill(e):Z(t)},Q.allocUnsafe=function(t){return tr(t)},Q.allocUnsafeSlow=function(t){return tr(t)},Q.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==Q.prototype},Q.compare=function(t,e){if(tN(t,Uint8Array)&&(t=Q.from(t,t.offset,t.byteLength)),tN(e,Uint8Array)&&(e=Q.from(e,e.offset,e.byteLength)),!Q.isBuffer(t)||!Q.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,i=e.length;for(let n=0,a=Math.min(r,i);n<a;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},Q.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Q.concat=function(t,e){let r;if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Q.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;let i=Q.allocUnsafe(e),n=0;for(r=0;r<t.length;++r){let e=t[r];if(tN(e,Uint8Array))n+e.length>i.length?(Q.isBuffer(e)||(e=Q.from(e)),e.copy(i,n)):Uint8Array.prototype.set.call(i,e,n);else if(Q.isBuffer(e))e.copy(i,n);else throw TypeError('"list" argument must be an Array of Buffers');n+=e.length}return i},Q.byteLength=ts,Q.prototype._isBuffer=!0,Q.prototype.swap16=function(){let t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)tu(this,e,e+1);return this},Q.prototype.swap32=function(){let t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)tu(this,e,e+3),tu(this,e+1,e+2);return this},Q.prototype.swap64=function(){let t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)tu(this,e,e+7),tu(this,e+1,e+6),tu(this,e+2,e+5),tu(this,e+3,e+4);return this},Q.prototype.toString=function(){let t=this.length;return 0===t?"":0==arguments.length?th(this,0,t):to.apply(this,arguments)},Q.prototype.toLocaleString=Q.prototype.toString,Q.prototype.equals=function(t){if(!Q.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===Q.compare(this,t)},Q.prototype.inspect=function(){let t="";return t=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(t+=" ... "),"<Buffer "+t+">"},J&&(Q.prototype[J]=Q.prototype.inspect),Q.prototype.compare=function(t,e,r,i,n){if(tN(t,Uint8Array)&&(t=Q.from(t,t.offset,t.byteLength)),!Q.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,n>>>=0,this===t)return 0;let a=n-i,s=r-e,o=Math.min(a,s),u=this.slice(i,n),f=t.slice(e,r);for(let t=0;t<o;++t)if(u[t]!==f[t]){a=u[t],s=f[t];break}return a<s?-1:s<a?1:0},Q.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},Q.prototype.indexOf=function(t,e,r){return tf(this,t,e,r,!0)},Q.prototype.lastIndexOf=function(t,e,r){return tf(this,t,e,r,!1)},Q.prototype.write=function(t,e,r,i){var n,a,s,o,u,f,l,h;if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let c=this.length-e;if((void 0===r||r>c)&&(r=c),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let p=!1;for(;;)switch(i){case"hex":return function(t,e,r,i){let n;r=Number(r)||0;let a=t.length-r;i?(i=Number(i))>a&&(i=a):i=a;let s=e.length;for(i>s/2&&(i=s/2),n=0;n<i;++n){let i=parseInt(e.substr(2*n,2),16);if(i!=i)break;t[r+n]=i}return n}(this,t,e,r);case"utf8":case"utf-8":return n=e,a=r,tP(tO(t,this.length-n),this,n,a);case"ascii":case"latin1":case"binary":return s=e,o=r,tP(function(t){let e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,s,o);case"base64":return u=e,f=r,tP(tS(t),this,u,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l=e,h=r,tP(function(t,e){let r,i;let n=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)i=(r=t.charCodeAt(a))>>8,n.push(r%256),n.push(i);return n}(t,this.length-l),this,l,h);default:if(p)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),p=!0}},Q.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Q.prototype.slice=function(t,e){let r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);let i=this.subarray(t,e);return Object.setPrototypeOf(i,Q.prototype),i},Q.prototype.readUintLE=Q.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||tc(t,e,this.length);let i=this[t],n=1,a=0;for(;++a<e&&(n*=256);)i+=this[t+a]*n;return i},Q.prototype.readUintBE=Q.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||tc(t,e,this.length);let i=this[t+--e],n=1;for(;e>0&&(n*=256);)i+=this[t+--e]*n;return i},Q.prototype.readUint8=Q.prototype.readUInt8=function(t,e){return t>>>=0,e||tc(t,1,this.length),this[t]},Q.prototype.readUint16LE=Q.prototype.readUInt16LE=function(t,e){return t>>>=0,e||tc(t,2,this.length),this[t]|this[t+1]<<8},Q.prototype.readUint16BE=Q.prototype.readUInt16BE=function(t,e){return t>>>=0,e||tc(t,2,this.length),this[t]<<8|this[t+1]},Q.prototype.readUint32LE=Q.prototype.readUInt32LE=function(t,e){return t>>>=0,e||tc(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Q.prototype.readUint32BE=Q.prototype.readUInt32BE=function(t,e){return t>>>=0,e||tc(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Q.prototype.readBigUInt64LE=tB(function(t){tv(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&tR(t,this.length-8);let i=e+256*this[++t]+65536*this[++t]+16777216*this[++t],n=this[++t]+256*this[++t]+65536*this[++t]+16777216*r;return BigInt(i)+(BigInt(n)<<BigInt(32))}),Q.prototype.readBigUInt64BE=tB(function(t){tv(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&tR(t,this.length-8);let i=16777216*e+65536*this[++t]+256*this[++t]+this[++t],n=16777216*this[++t]+65536*this[++t]+256*this[++t]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)}),Q.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||tc(t,e,this.length);let i=this[t],n=1,a=0;for(;++a<e&&(n*=256);)i+=this[t+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},Q.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||tc(t,e,this.length);let i=e,n=1,a=this[t+--i];for(;i>0&&(n*=256);)a+=this[t+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*e)),a},Q.prototype.readInt8=function(t,e){return(t>>>=0,e||tc(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},Q.prototype.readInt16LE=function(t,e){t>>>=0,e||tc(t,2,this.length);let r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Q.prototype.readInt16BE=function(t,e){t>>>=0,e||tc(t,2,this.length);let r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Q.prototype.readInt32LE=function(t,e){return t>>>=0,e||tc(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Q.prototype.readInt32BE=function(t,e){return t>>>=0,e||tc(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Q.prototype.readBigInt64LE=tB(function(t){tv(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&tR(t,this.length-8),(BigInt(this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24))<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+16777216*this[++t])}),Q.prototype.readBigInt64BE=tB(function(t){tv(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&tR(t,this.length-8),(BigInt((e<<24)+65536*this[++t]+256*this[++t]+this[++t])<<BigInt(32))+BigInt(16777216*this[++t]+65536*this[++t]+256*this[++t]+r)}),Q.prototype.readFloatLE=function(t,e){return t>>>=0,e||tc(t,4,this.length),o(this,t,!0,23,4)},Q.prototype.readFloatBE=function(t,e){return t>>>=0,e||tc(t,4,this.length),o(this,t,!1,23,4)},Q.prototype.readDoubleLE=function(t,e){return t>>>=0,e||tc(t,8,this.length),o(this,t,!0,52,8)},Q.prototype.readDoubleBE=function(t,e){return t>>>=0,e||tc(t,8,this.length),o(this,t,!1,52,8)},Q.prototype.writeUintLE=Q.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;tp(this,t,e,r,i,0)}let n=1,a=0;for(this[e]=255&t;++a<r&&(n*=256);)this[e+a]=t/n&255;return e+r},Q.prototype.writeUintBE=Q.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;tp(this,t,e,r,i,0)}let n=r-1,a=1;for(this[e+n]=255&t;--n>=0&&(a*=256);)this[e+n]=t/a&255;return e+r},Q.prototype.writeUint8=Q.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,1,255,0),this[e]=255&t,e+1},Q.prototype.writeUint16LE=Q.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},Q.prototype.writeUint16BE=Q.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},Q.prototype.writeUint32LE=Q.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},Q.prototype.writeUint32BE=Q.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},Q.prototype.writeBigUInt64LE=tB(function(t,e=0){return tg(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),Q.prototype.writeBigUInt64BE=tB(function(t,e=0){return td(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),Q.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){let i=Math.pow(2,8*r-1);tp(this,t,e,r,i-1,-i)}let n=0,a=1,s=0;for(this[e]=255&t;++n<r&&(a*=256);)t<0&&0===s&&0!==this[e+n-1]&&(s=1),this[e+n]=(t/a>>0)-s&255;return e+r},Q.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){let i=Math.pow(2,8*r-1);tp(this,t,e,r,i-1,-i)}let n=r-1,a=1,s=0;for(this[e+n]=255&t;--n>=0&&(a*=256);)t<0&&0===s&&0!==this[e+n+1]&&(s=1),this[e+n]=(t/a>>0)-s&255;return e+r},Q.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},Q.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},Q.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},Q.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},Q.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||tp(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},Q.prototype.writeBigInt64LE=tB(function(t,e=0){return tg(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),Q.prototype.writeBigInt64BE=tB(function(t,e=0){return td(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),Q.prototype.writeFloatLE=function(t,e,r){return ty(this,t,e,!0,r)},Q.prototype.writeFloatBE=function(t,e,r){return ty(this,t,e,!1,r)},Q.prototype.writeDoubleLE=function(t,e,r){return tb(this,t,e,!0,r)},Q.prototype.writeDoubleBE=function(t,e,r){return tb(this,t,e,!1,r)},Q.prototype.copy=function(t,e,r,i){if(!Q.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);let n=i-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),n},Q.prototype.fill=function(t,e,r,i){let n;if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!Q.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===t.length){let e=t.charCodeAt(0);("utf8"===i&&e<128||"latin1"===i)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(n=e;n<r;++n)this[n]=t;else{let a=Q.isBuffer(t)?t:Q.from(t,i),s=a.length;if(0===s)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<r-e;++n)this[n+e]=a[n%s]}return this};let tE={};function tw(t,e,r){tE[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function tT(t){let e="",r=t.length,i="-"===t[0]?1:0;for(;r>=i+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function tA(t,e,r,i,n,a){if(t>r||t<e){let i;let n="bigint"==typeof e?"n":"";throw i=a>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${(a+1)*8}${n}`:`>= -(2${n} ** ${(a+1)*8-1}${n}) and < 2 ** ${(a+1)*8-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new tE.ERR_OUT_OF_RANGE("value",i,t)}tv(n,"offset"),(void 0===i[n]||void 0===i[n+a])&&tR(n,i.length-(a+1))}function tv(t,e){if("number"!=typeof t)throw new tE.ERR_INVALID_ARG_TYPE(e,"number",t)}function tR(t,e,r){if(Math.floor(t)!==t)throw tv(t,r),new tE.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new tE.ERR_BUFFER_OUT_OF_BOUNDS;throw new tE.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}tw("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),tw("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError),tw("ERR_OUT_OF_RANGE",function(t,e,r){let i=`The value of "${t}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>4294967296?n=tT(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=tT(n)),n+="n"),i+=` It must be ${e}. Received ${n}`},RangeError);let tI=/[^+/0-9A-Za-z-_]/g;function tO(t,e){let r;e=e||1/0;let i=t.length,n=null,a=[];for(let s=0;s<i;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!n){if(r>56319||s+1===i){(e-=3)>-1&&a.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function tS(t){return a(function(t){if((t=(t=t.split("=")[0]).trim().replace(tI,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function tP(t,e,r,i){let n;for(n=0;n<i&&!(n+r>=e.length)&&!(n>=t.length);++n)e[n+r]=t[n];return n}function tN(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}let tD=function(){let t="0123456789abcdef",e=Array(256);for(let r=0;r<16;++r){let i=16*r;for(let n=0;n<16;++n)e[i+n]=t[r]+t[n]}return e}();function tB(t){return"undefined"==typeof BigInt?tL:t}function tL(){throw Error("BigInt not supported")}class tU extends k{constructor(){super(),this.buffer=""}push(t){let e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)}}let tF=function(t){let e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),r={};return e[1]&&(r.length=parseInt(e[1],10)),e[2]&&(r.offset=parseInt(e[2],10)),r},tC=function(t){let e;let r={};if(!t)return r;let i=t.split(RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n=i.length;for(;n--;)""!==i[n]&&((e=/([^=]*)=(.*)/.exec(i[n]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),r[e[0]]=e[1]);return r};class tx extends k{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let r,i;if(0!==(e=e.trim()).length){if("#"!==e[0]){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((t,r)=>{let i=r(e);return i===e?t:t.concat([i])},[e]).forEach(e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0!==e.indexOf("#EXT")){this.trigger("data",{type:"comment",text:e.slice(1)});return}if(e=e.replace("\r",""),r=/^#EXTM3U/.exec(e)){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(r=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e)){i={type:"tag",tagType:"inf"},r[1]&&(i.duration=parseFloat(r[1])),r[2]&&(i.title=r[2]),this.trigger("data",i);return}if(r=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e)){i={type:"tag",tagType:"targetduration"},r[1]&&(i.duration=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e)){i={type:"tag",tagType:"version"},r[1]&&(i.version=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e)){i={type:"tag",tagType:"media-sequence"},r[1]&&(i.number=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e)){i={type:"tag",tagType:"discontinuity-sequence"},r[1]&&(i.number=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e)){i={type:"tag",tagType:"playlist-type"},r[1]&&(i.playlistType=r[1]),this.trigger("data",i);return}if(r=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e)){i=t(j)(tF(r[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",i);return}if(r=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e)){i={type:"tag",tagType:"allow-cache"},r[1]&&(i.allowed=!/NO/.test(r[1])),this.trigger("data",i);return}if(r=/^#EXT-X-MAP:(.*)$/.exec(e)){if(i={type:"tag",tagType:"map"},r[1]){let t=tC(r[1]);t.URI&&(i.uri=t.URI),t.BYTERANGE&&(i.byterange=tF(t.BYTERANGE))}this.trigger("data",i);return}if(r=/^#EXT-X-STREAM-INF:(.*)$/.exec(e)){if(i={type:"tag",tagType:"stream-inf"},r[1]){if(i.attributes=tC(r[1]),i.attributes.RESOLUTION){let t=i.attributes.RESOLUTION.split("x"),e={};t[0]&&(e.width=parseInt(t[0],10)),t[1]&&(e.height=parseInt(t[1],10)),i.attributes.RESOLUTION=e}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}this.trigger("data",i);return}if(r=/^#EXT-X-MEDIA:(.*)$/.exec(e)){i={type:"tag",tagType:"media"},r[1]&&(i.attributes=tC(r[1])),this.trigger("data",i);return}if(r=/^#EXT-X-ENDLIST/.exec(e)){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(r=/^#EXT-X-DISCONTINUITY/.exec(e)){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(r=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e)){i={type:"tag",tagType:"program-date-time"},r[1]&&(i.dateTimeString=r[1],i.dateTimeObject=new Date(r[1])),this.trigger("data",i);return}if(r=/^#EXT-X-KEY:(.*)$/.exec(e)){i={type:"tag",tagType:"key"},r[1]&&(i.attributes=tC(r[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),this.trigger("data",i);return}if(r=/^#EXT-X-START:(.*)$/.exec(e)){i={type:"tag",tagType:"start"},r[1]&&(i.attributes=tC(r[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),this.trigger("data",i);return}if(r=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e)){i={type:"tag",tagType:"cue-out-cont"},r[1]?i.data=r[1]:i.data="",this.trigger("data",i);return}if(r=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e)){i={type:"tag",tagType:"cue-out"},r[1]?i.data=r[1]:i.data="",this.trigger("data",i);return}if(r=/^#EXT-X-CUE-IN:(.*)?$/.exec(e)){i={type:"tag",tagType:"cue-in"},r[1]?i.data=r[1]:i.data="",this.trigger("data",i);return}if((r=/^#EXT-X-SKIP:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"skip"}).attributes=tC(r[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split("	")),this.trigger("data",i);return}if((r=/^#EXT-X-PART:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"part"}).attributes=tC(r[1]),["DURATION"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))}),["INDEPENDENT","GAP"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/.test(i.attributes[t]))}),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=tF(i.attributes.BYTERANGE)),this.trigger("data",i);return}if((r=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"server-control"}).attributes=tC(r[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/.test(i.attributes[t]))}),this.trigger("data",i);return}if((r=/^#EXT-X-PART-INF:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"part-inf"}).attributes=tC(r[1]),["PART-TARGET"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))}),this.trigger("data",i);return}if((r=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"preload-hint"}).attributes=tC(r[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(t){if(i.attributes.hasOwnProperty(t)){i.attributes[t]=parseInt(i.attributes[t],10);let e="BYTERANGE-LENGTH"===t?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[e]=i.attributes[t],delete i.attributes[t]}}),this.trigger("data",i);return}if((r=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"rendition-report"}).attributes=tC(r[1]),["LAST-MSN","LAST-PART"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseInt(i.attributes[t],10))}),this.trigger("data",i);return}if((r=/^#EXT-X-DATERANGE:(.*)$/.exec(e))&&r[1]){(i={type:"tag",tagType:"daterange"}).attributes=tC(r[1]),["ID","CLASS"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=String(i.attributes[t]))}),["START-DATE","END-DATE"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=new Date(i.attributes[t]))}),["DURATION","PLANNED-DURATION"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))}),["END-ON-NEXT"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/i.test(i.attributes[t]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=i.attributes[t].toString(16))});let t=/^X-([A-Z]+-)+[A-Z]+$/;for(let e in i.attributes){if(!t.test(e))continue;let r=/[0-9A-Fa-f]{6}/g.test(i.attributes[e]),n=/^\d+(\.\d+)?$/.test(i.attributes[e]);i.attributes[e]=r?i.attributes[e].toString(16):n?parseFloat(i.attributes[e]):String(i.attributes[e])}this.trigger("data",i);return}if(r=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e)){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(r=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(e)){(i={type:"tag",tagType:"content-steering"}).attributes=tC(r[1]),this.trigger("data",i);return}this.trigger("data",{type:"tag",data:e.slice(4)})})}}addParser({expression:t,customType:e,dataParser:r,segment:i}){"function"!=typeof r&&(r=t=>t),this.customParsers.push(n=>{if(t.exec(n))return this.trigger("data",{type:"custom",data:r(n),customType:e,segment:i}),!0})}addTagMapper({expression:t,map:e}){this.tagMappers.push(r=>t.test(r)?e(r):r)}}let tX=t=>t.toLowerCase().replace(/-(\w)/g,t=>t[1].toUpperCase()),t$=function(t){let e={};return Object.keys(t).forEach(function(r){e[tX(r)]=t[r]}),e},tM=function(t){let{serverControl:e,targetDuration:r,partTargetDuration:i}=t;if(!e)return;let n="#EXT-X-SERVER-CONTROL",a="holdBack",s="partHoldBack",o=r&&3*r,u=i&&2*i;r&&!e.hasOwnProperty(a)&&(e[a]=o,this.trigger("info",{message:`${n} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&e[a]<o&&(this.trigger("warn",{message:`${n} clamping HOLD-BACK (${e[a]}) to targetDuration * 3 (${o})`}),e[a]=o),i&&!e.hasOwnProperty(s)&&(e[s]=3*i,this.trigger("info",{message:`${n} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[s]}).`})),i&&e[s]<u&&(this.trigger("warn",{message:`${n} clamping PART-HOLD-BACK (${e[s]}) to partTargetDuration * 2 (${u}).`}),e[s]=u)};class t_ extends k{constructor(){let e,r;super(),this.lineStream=new tU,this.parseStream=new tx,this.lineStream.pipe(this.parseStream),this.lastProgramDateTime=null;let i=this,n=[],a={},s=!1,o=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},f=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],segments:[]};let l=0,h=0,c={};this.on("end",()=>{!a.uri&&(a.parts||a.preloadHints)&&(!a.map&&e&&(a.map=e),!a.key&&r&&(a.key=r),a.timeline||"number"!=typeof f||(a.timeline=f),this.manifest.preloadSegment=a)}),this.parseStream.on("data",function(p){let g,d;({tag(){(({version(){p.version&&(this.manifest.version=p.version)},"allow-cache"(){this.manifest.allowCache=p.allowed,"allowed"in p||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){let t={};"length"in p&&(a.byterange=t,t.length=p.length,"offset"in p||(p.offset=l)),"offset"in p&&(a.byterange=t,t.offset=p.offset),l=t.offset+t.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),p.title&&(a.title=p.title),p.duration>0&&(a.duration=p.duration),0===p.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key(){if(!p.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if("NONE"===p.attributes.METHOD){r=null;return}if(!p.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if("com.apple.streamingkeydelivery"===p.attributes.KEYFORMAT){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:p.attributes};return}if("com.microsoft.playready"===p.attributes.KEYFORMAT){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:p.attributes.URI};return}if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===p.attributes.KEYFORMAT){if(-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(p.attributes.METHOD)){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if("SAMPLE-AES-CENC"===p.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==p.attributes.URI.substring(0,23)){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(p.attributes.KEYID&&"0x"===p.attributes.KEYID.substring(0,2))){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:p.attributes.KEYFORMAT,keyId:p.attributes.KEYID.substring(2)},pssh:function(e){for(var r=t(Y).atob?t(Y).atob(e):Q.from(e,"base64").toString("binary"),i=new Uint8Array(r.length),n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i}(p.attributes.URI.split(",")[1])};return}p.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:p.attributes.METHOD||"AES-128",uri:p.attributes.URI},void 0!==p.attributes.IV&&(r.iv=p.attributes.IV)},"media-sequence"(){if(!isFinite(p.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+p.number});return}this.manifest.mediaSequence=p.number},"discontinuity-sequence"(){if(!isFinite(p.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+p.number});return}this.manifest.discontinuitySequence=p.number,f=p.number},"playlist-type"(){if(!/VOD|EVENT/.test(p.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+p.playlist});return}this.manifest.playlistType=p.playlistType},map(){e={},p.uri&&(e.uri=p.uri),p.byterange&&(e.byterange=p.byterange),r&&(e.key=r)},"stream-inf"(){if(this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||u,!p.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}a.attributes||(a.attributes={}),t(j)(a.attributes,p.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,!(p.attributes&&p.attributes.TYPE&&p.attributes["GROUP-ID"]&&p.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}let t=this.manifest.mediaGroups[p.attributes.TYPE];t[p.attributes["GROUP-ID"]]=t[p.attributes["GROUP-ID"]]||{},g=t[p.attributes["GROUP-ID"]],(d={default:/yes/i.test(p.attributes.DEFAULT)}).default?d.autoselect=!0:d.autoselect=/yes/i.test(p.attributes.AUTOSELECT),p.attributes.LANGUAGE&&(d.language=p.attributes.LANGUAGE),p.attributes.URI&&(d.uri=p.attributes.URI),p.attributes["INSTREAM-ID"]&&(d.instreamId=p.attributes["INSTREAM-ID"]),p.attributes.CHARACTERISTICS&&(d.characteristics=p.attributes.CHARACTERISTICS),p.attributes.FORCED&&(d.forced=/yes/i.test(p.attributes.FORCED)),g[p.attributes.NAME]=d},discontinuity(){f+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=p.dateTimeString,this.manifest.dateTimeObject=p.dateTimeObject),a.dateTimeString=p.dateTimeString,a.dateTimeObject=p.dateTimeObject;let{lastProgramDateTime:t}=this;this.lastProgramDateTime=new Date(p.dateTimeString).getTime(),null===t&&this.manifest.segments.reduceRight((t,e)=>(e.programDateTime=t-1e3*e.duration,e.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(p.duration)||p.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+p.duration});return}this.manifest.targetDuration=p.duration,tM.call(this,this.manifest)},start(){if(!p.attributes||isNaN(p.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:p.attributes["TIME-OFFSET"],precise:p.attributes.PRECISE}},"cue-out"(){a.cueOut=p.data},"cue-out-cont"(){a.cueOutCont=p.data},"cue-in"(){a.cueIn=p.data},skip(){this.manifest.skip=t$(p.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",p.attributes,["SKIPPED-SEGMENTS"])},part(){s=!0;let t=this.manifest.segments.length,e=t$(p.attributes);a.parts=a.parts||[],a.parts.push(e),e.byterange&&(e.byterange.hasOwnProperty("offset")||(e.byterange.offset=h),h=e.byterange.offset+e.byterange.length);let r=a.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${r} for segment #${t}`,p.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((t,e)=>{t.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${e} lacks required attribute(s): LAST-PART`})})},"server-control"(){let t=this.manifest.serverControl=t$(p.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),tM.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){let t=this.manifest.segments.length,e=t$(p.attributes),r=e.type&&"PART"===e.type;a.preloadHints=a.preloadHints||[],a.preloadHints.push(e),e.byterange&&!e.byterange.hasOwnProperty("offset")&&(e.byterange.offset=r?h:0,r&&(h=e.byterange.offset+e.byterange.length));let i=a.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${i} for segment #${t}`,p.attributes,["TYPE","URI"]),e.type)for(let r=0;r<a.preloadHints.length-1;r++){let n=a.preloadHints[r];n.type&&n.type===e.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${i} for segment #${t} has the same TYPE ${e.type} as preload hint #${r}`})}},"rendition-report"(){let t=t$(p.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);let e=this.manifest.renditionReports.length-1,r=["LAST-MSN","URI"];s&&r.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${e}`,p.attributes,r)},"part-inf"(){this.manifest.partInf=t$(p.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",p.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),tM.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(t$(p.attributes));let e=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${e}`,p.attributes,["ID","START-DATE"]);let r=this.manifest.dateRanges[e];r.endDate&&r.startDate&&new Date(r.endDate)<new Date(r.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),r.duration&&r.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),r.plannedDuration&&r.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});let i=!!r.endOnNext;if(i&&!r.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),i&&(r.duration||r.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),r.duration&&r.endDate){let t=r.startDate.getTime()+1e3*r.duration;this.manifest.dateRanges[e].endDate=new Date(t)}if(c[r.id]){for(let t in c[r.id])if(r[t]&&JSON.stringify(c[r.id][t])!==JSON.stringify(r[t])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}let e=this.manifest.dateRanges.findIndex(t=>t.id===r.id);this.manifest.dateRanges[e]=t(j)(this.manifest.dateRanges[e],r),c[r.id]=t(j)(c[r.id],r),this.manifest.dateRanges.pop()}else c[r.id]=r},"independent-segments"(){this.manifest.independentSegments=!0},"content-steering"(){this.manifest.contentSteering=t$(p.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",p.attributes,["SERVER-URI"])}})[p.tagType]||o).call(i)},uri(){a.uri=p.uri,n.push(a),!this.manifest.targetDuration||"duration"in a||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),r&&(a.key=r),a.timeline=f,e&&(a.map=e),h=0,null!==this.lastProgramDateTime&&(a.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*a.duration),a={}},comment(){},custom(){p.segment?(a.custom=a.custom||{},a.custom[p.customType]=p.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[p.customType]=p.data)}})[p.type].call(i)})}warnOnMissingAttributes_(t,e,r){let i=[];r.forEach(function(t){e.hasOwnProperty(t)||i.push(t)}),i.length&&this.trigger("warn",{message:`${t} lacks required attribute(s): ${i.join(", ")}`})}push(t){this.lineStream.push(t)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(t){this.parseStream.addParser(t)}addTagMapper(t){this.parseStream.addTagMapper(t)}}window.ffmpeg??=(0,l.createFFmpeg)({mainName:"main",log:!0,corePath:"https://unpkg.com/@ffmpeg/core-st@0.11.1/dist/ffmpeg-core.js"}),(async()=>{window.ffmpeg.isLoaded()||await window.ffmpeg.load();let t=document.querySelector("[data-hls-url]")?.getAttribute("data-hls-url")||document.querySelector("shreddit-player source")?.getAttribute("src");if(!t)return;let e=await fetch(t),r=await e.text(),i=new t_;i.push(r),i.end();let n=i.manifest,a=n.playlists.reduce((t,e)=>t.attributes.BANDWIDTH>e.attributes.BANDWIDTH?t:e),s=a.attributes.AUDIO,o=Object.values(n.mediaGroups.AUDIO[s]).find(t=>t.default),u=new URL(a.uri,t).toString(),f=new URL(o.uri,t).toString(),[l,h]=await Promise.all([fetch(u).then(t=>t.text()),fetch(f).then(t=>t.text())]),c=new t_;c.push(l),c.end();let p=c.manifest,g=new t_;g.push(h),g.end();let d=g.manifest,[m,y]=await Promise.all([fetch(new URL(p.segments[0].uri,u)).then(t=>t.arrayBuffer()).then(t=>new Uint8Array(t)),fetch(new URL(d.segments[0].uri,f)).then(t=>t.arrayBuffer()).then(t=>new Uint8Array(t))]),b=p.segments[0].uri.split(".").pop(),E=d.segments[0].uri.split(".").pop(),w=`video.${b}`,T=`audio.${E}`;await ffmpeg.FS("writeFile",w,m),await ffmpeg.FS("writeFile",T,y),await ffmpeg.run("-i",w,"-i",T,"-c","copy","output.mp4");let A=ffmpeg.FS("readFile","output.mp4");window.ffmpeg.exit();let v=document.createElement("a");v.href=window.URL.createObjectURL(new Blob([A.buffer],{type:"video/mp4"})),v.download=`${document.title}.mp4`,document.body.appendChild(v),v.click(),document.body.removeChild(v)})()})();
//# sourceMappingURL=index.js.map
